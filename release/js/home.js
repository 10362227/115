!function(){"use strict";var e=function(){this._listeners={}};e.prototype.on=function(e,t){(this._listeners[e]=this._listeners[e]||[]).push(t)},e.prototype.trigger=function(e,t){(this._listeners[e]||[]).forEach((function(e){return e(t)}))},e.prototype.off=function(e){delete this._listeners[e]};var t=function(e){function t(){e.call(this),this.defaultRPC=[{name:"ARIA2 RPC",url:"http://localhost:6800/jsonrpc"}],this.defaultUserAgent="Mozilla/5.0 (Windows NT 5.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/31.0.1650.63 Safari/537.36 115Browser/5.1.3",this.defaultReferer="https://115.com/",this.defaultConfigData={rpcList:this.defaultRPC,configSync:!1,sha1Check:!1,vip:!1,ssl:!1,small:!1,interval:300,downloadPath:"",userAgent:this.defaultUserAgent,browserUserAgent:!0,referer:this.defaultReferer,headers:""},this.configData={},this.on("initConfigData",this.init.bind(this)),this.on("setConfigData",this.set.bind(this)),this.on("clearConfigData",this.clear.bind(this))}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.init=function(){var e=this;chrome.storage.sync.get(null,(function(e){var t=function(t){chrome.storage.local.set({key:e[t]},(function(){console.log("chrome first local set: %s, %s",t,e[t])}))};for(var n in e)t(n)})),chrome.storage.local.get(null,(function(t){e.configData=Object.assign({},e.defaultConfigData,t),e.trigger("updateView",e.configData)}))},t.prototype.getConfigData=function(e){return void 0===e&&(e=null),e?this.configData[e]:this.configData},t.prototype.set=function(e){this.configData=e,this.save(e),this.trigger("updateView",e)},t.prototype.save=function(e){var t,n,o=function(o){chrome.storage.local.set(((t={})[o]=e[o],t),(function(){console.log("chrome local set: %s, %s",o,e[o])})),!0===e.configSync&&chrome.storage.sync.set(((n={})[o]=e[o],n),(function(){console.log("chrome sync set: %s, %s",o,e[o])}))};for(var i in e)o(i)},t.prototype.clear=function(){chrome.storage.sync.clear(),chrome.storage.local.clear(),this.configData=this.defaultConfigData,this.trigger("updateView",this.configData)},t}(e),n=new t,o=function(){this.cookies={}};o.prototype.httpSend=function(e,t,n){var o=e.url,i=e.options;fetch(o,i).then((function(e){e.ok?e.json().then((function(e){t(e)})):n(e)})).catch((function(e){n(e)}))},o.prototype.getConfigData=function(e){return void 0===e&&(e=null),n.getConfigData(e)},o.prototype.objectToQueryString=function(e){return Object.keys(e).map((function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])})).join("&")},o.prototype.sendToBackground=function(e,t,n){chrome.runtime.sendMessage({method:e,data:t},n)},o.prototype.showToast=function(e,t){window.postMessage({type:"showToast",data:{message:e,type:t}},location.origin)},o.prototype.getHashParameter=function(e){var t=window.location.hash.substr(1);return new URLSearchParams(t).get(e)},o.prototype.formatCookies=function(){var e=[];for(var t in this.cookies)e.push(t+"="+this.cookies[t]);return e.join("; ")},o.prototype.getHeader=function(e){void 0===e&&(e="RPC");var t=[],n=this.getConfigData("browserUserAgent"),o=this.getConfigData("userAgent");if(n){var i=navigator.userAgent;i&&i.length&&(o=i)}t.push("User-Agent: "+o),t.push("Referer: "+this.getConfigData("referer")),t.push("Cookie: "+this.formatCookies());var s=this.getConfigData("headers");return s&&s.split("\n").forEach((function(e){t.push(e)})),"RPC"===e?t:"aria2Cmd"===e?t.map((function(e){return"--header "+JSON.stringify(e)})).join(" "):"aria2c"===e?t.map((function(e){return" header="+e})).join("\n"):"idm"===e?t.map((function(e){var t=e.split(": ");return t[0].toLowerCase()+": "+t[1]})).join("\r\n"):void 0},o.prototype.parseURL=function(e){var t=new URL(e),n=t.username?t.username+":"+decodeURI(t.password):null;n&&(n.includes("token:")||(n="Basic "+btoa(n)));var o=t.hash.substr(1),i={},s=new URLSearchParams(o);for(var r of s){var a=r[0],c=r[1];i[a]=c.length?c:"enabled"}return{authStr:n,path:t.origin+t.pathname,options:i}},o.prototype.generateParameter=function(e,t,n){e&&e.startsWith("token")&&n.params.unshift(e);var o={url:t,options:{method:"POST",headers:{},body:JSON.stringify(n)}};return e&&e.startsWith("Basic")&&(o.options.headers.Authorization=e),o},o.prototype.getVersion=function(e,t){var n=this.parseURL(e),o=n.authStr,i=n.path;this.sendToBackground("rpcVersion",this.generateParameter(o,i,{jsonrpc:"2.0",method:"aria2.getVersion",id:1,params:[]}),(function(e){t.innerText=e?"Aria2版本为: "+e:"错误,请查看是否开启Aria2"}))},o.prototype.copyText=function(e){var t=document.createElement("textarea");document.body.appendChild(t),t.value=e,t.focus(),t.select();var n=document.execCommand("copy");t.remove(),n?this.showToast("拷贝成功~","inf"):this.showToast("拷贝失败 QAQ","err")},o.prototype.requestCookies=function(e){var t=this;return new Promise((function(n){t.sendToBackground("getCookies",e,(function(e){n(e)}))}))},o.prototype.aria2RPCMode=function(e,t){var n=this,o=this.parseURL(e),i=o.authStr,s=o.path,r=o.options,a=this.getConfigData("ssl");this.getConfigData("small")&&t.sort((function(e,t){return e.size-t.size})),t.forEach((function(e){n.cookies=e.cookies,a&&(e.link=e.link.replace(/^(http:\/\/)/,"https://"));var t={jsonrpc:"2.0",method:"aria2.addUri",id:(new Date).getTime(),params:[[e.link],{out:e.name,header:n.getHeader()}]},o=n.getConfigData("sha1Check"),c=t.params[1],l=n.getConfigData("downloadPath");if(l&&(c.dir=l),o&&(c.checksum="sha-1="+e.sha1),r)for(var u in r)c[u]=r[u];n.sendToBackground("rpcData",n.generateParameter(i,s,t),(function(e){e?n.showToast("下载成功!赶紧去看看吧~","inf"):n.showToast("下载失败!是不是没有开启Aria2?","err")}))}))},o.prototype.aria2TXTMode=function(e){var t=this,n=[],o=[],i=[],s=[],r="data:text/plain;charset=utf-8,",a=this.getConfigData("ssl");e.forEach((function(e){t.cookies=e.cookies,a&&(e.link=e.link.replace(/^(http:\/\/)/,"https://"));var r="aria2c -c -s10 -k1M -x16 --enable-rpc=false -o "+JSON.stringify(e.name)+" "+t.getHeader("aria2Cmd")+" "+JSON.stringify(e.link),c=[e.link,t.getHeader("aria2c")," out="+e.name].join("\n");t.getConfigData("sha1Check")&&(r+=" --checksum=sha-1="+e.sha1,c+="\n checksum=sha-1="+e.sha1),n.push(r),o.push(c);var l=["<",e.link,t.getHeader("idm"),">"].join("\r\n");i.push(l),s.push(e.link)})),document.querySelector("#aria2CmdTxt").value=""+n.join("\n"),document.querySelector("#aria2Txt").href=""+r+encodeURIComponent(o.join("\n")),document.querySelector("#idmTxt").href=""+r+encodeURIComponent(i.join("\r\n")+"\r\n"),document.querySelector("#downloadLinkTxt").href=""+r+encodeURIComponent(s.join("\n")),document.querySelector("#copyDownloadLinkTxt").dataset.link=s.join("\n")};var i=new o,s=function(){var e=this;this.version="0.4.2",this.updateDate="2022/05/22",n.on("updateView",(function(t){e.updateSetting(t),e.updateMenu(t)}))};s.prototype.init=function(){this.context=document.querySelector('iframe[rel="wangpan"]').contentDocument,this.addSettingUI(),this.addTextExport(),n.trigger("initConfigData")},s.prototype.addMenu=function(e,t){if(e){e.insertAdjacentHTML(t,'\n      <div id="exportMenu" class="export">\n        <a class="export-button">导出下载</a>\n        <div id="aria2List" class="export-menu">\n          <a class="export-menu-item" id="batchOpen" href="javascript:void(0);">批量打开</a>\n          <a class="export-menu-item" id="aria2Text" href="javascript:void(0);">文本导出</a>\n          <a class="export-menu-item" id="settingButton" href="javascript:void(0);">设置</a>\n        </div>\n      </div>');var n=this.context.querySelector("#exportMenu");n.addEventListener("mouseenter",(function(){n.classList.add("open-o")})),n.addEventListener("mouseleave",(function(){n.classList.remove("open-o")}));var o=this.context.querySelector("#settingButton"),i=document.querySelector("#settingMenu");o.addEventListener("click",(function(e){i.classList.add("open-o")})),this.context.querySelector("#aria2List").addEventListener("mousedown",(function(e){e.stopPropagation()}))}},s.prototype.addContextMenuRPCSectionWithCallback=function(e){var t=this,n=function(n){n.insertAdjacentHTML("beforebegin",'<div class="cell" id="more-menu-rpc-section"><ul></ul></div>'),t.mostRecentConfigData&&t.updateMenu(t.mostRecentConfigData),e&&e()},o=this.context.querySelector("body > .context-menu .cell");if(o)n(o);else if("MutationObserver"in window){var i=this.context.querySelector("body"),s=new MutationObserver((function(e){var o=t.context.querySelector("body > .context-menu .cell");o&&(s.disconnect(),n(o))}));s.observe(i,{childList:!0})}},s.prototype.resetMenu=function(){this.context.querySelectorAll("#more-menu-rpc-section li").forEach((function(e){e.remove()})),this.context.querySelectorAll(".rpc-button").forEach((function(e){e.remove()}))},s.prototype.updateMenu=function(e){this.resetMenu();var t=e.rpcList,n="",o="";t.forEach((function(e){var t='<a class="export-menu-item rpc-button" href="javascript:void(0);" data-url='+e.url+">"+e.name+"</a>";n+=t,o+='<li><a href="javascript:void(0);" data-url='+e.url+">"+e.name+"</a></li>"})),this.context.querySelector("#aria2List").insertAdjacentHTML("afterbegin",n);var i=this.context.querySelector("#more-menu-rpc-section ul");i&&i.insertAdjacentHTML("afterbegin",o)},s.prototype.addTextExport=function(){var e=this;document.body.insertAdjacentHTML("beforeend",'\n      <div id="textMenu" class="modal text-menu">\n        <div class="modal-inner">\n          <div class="modal-header">\n            <div class="modal-title">文本导出</div>\n            <div class="modal-close">×</div>\n          </div>\n          <div class="modal-body">\n            <div class="text-menu-row">\n              <a class="text-menu-button" href="javascript:void(0);" id="aria2Txt" download="aria2c.down">存为Aria2文件</a>\n              <a class="text-menu-button" href="javascript:void(0);" id="idmTxt" download="idm.ef2">存为IDM文件</a>\n              <a class="text-menu-button" href="javascript:void(0);" id="downloadLinkTxt" download="link.txt">保存下载链接</a>\n              <a class="text-menu-button" href="javascript:void(0);" id="copyDownloadLinkTxt">拷贝下载链接</a>\n            </div>\n            <div class="text-menu-row">\n              <textarea class="text-menu-textarea" type="textarea" wrap="off" spellcheck="false" id="aria2CmdTxt"></textarea>\n            </div>\n          </div>\n        </div>\n      </div>');var t=document.querySelector("#textMenu"),n=t.querySelector(".modal-close"),o=t.querySelector("#copyDownloadLinkTxt");o.addEventListener("click",(function(){i.copyText(o.dataset.link)})),n.addEventListener("click",(function(){t.classList.remove("open-o"),e.resetTextExport()}))},s.prototype.resetTextExport=function(){var e=document.querySelector("#textMenu");e.querySelector("#aria2Txt").href="",e.querySelector("#idmTxt").href="",e.querySelector("#downloadLinkTxt").href="",e.querySelector("#aria2CmdTxt").value="",e.querySelector("#copyDownloadLinkTxt").dataset.link=""},s.prototype.addSettingUI=function(){var e=this,t='\n      <div id="settingMenu" class="modal setting-menu">\n        <div class="modal-inner">\n          <div class="modal-header">\n            <div class="modal-title">导出设置</div>\n            <div class="modal-close">×</div>\n          </div>\n          <div class="modal-body">\n            <div class="setting-menu-message">\n              <label class="setting-menu-label orange-o" id="message"></label>\n            </div>\n            <div class="setting-menu-row rpc-s">\n              <div class="setting-menu-name">\n                <input class="setting-menu-input name-s" spellcheck="false">\n              </div>\n              <div class="setting-menu-value">\n                <input class="setting-menu-input url-s" spellcheck="false">\n                <a class="setting-menu-button" id="addRPC" href="javascript:void(0);">添加RPC地址</a>\n              </div>\n            </div>\x3c!-- /.setting-menu-row --\x3e\n            <div class="setting-menu-row">\n              <div class="setting-menu-name">\n                <label class="setting-menu-label">配置同步</label>\n              </div>\n              <div class="setting-menu-value">\n                <input type="checkbox" class="setting-menu-checkbox configSync-s">\n              </div>\n            </div>\x3c!-- /.setting-menu-row --\x3e\n            <div class="setting-menu-row">\n              <div class="setting-menu-name">\n                <label class="setting-menu-label">SHA1校验</label>\n              </div>\n              <div class="setting-menu-value">\n                <input type="checkbox" class="setting-menu-checkbox sha1Check-s">\n              </div>\n            </div>\x3c!-- /.setting-menu-row --\x3e\n            <div class="setting-menu-row">\n              <div class="setting-menu-name">\n                <label class="setting-menu-label">115会员</label>\n              </div>\n              <div class="setting-menu-value">\n                <input type="checkbox" class="setting-menu-checkbox vip-s">\n              </div>\n            </div>\x3c!-- /.setting-menu-row --\x3e\n            <div class="setting-menu-row">\n              <div class="setting-menu-name">\n                <label class="setting-menu-label">小文件优先</label>\n              </div>\n              <div class="setting-menu-value">\n                <input type="checkbox" class="setting-menu-checkbox small-s">\n              </div>\n            </div>\x3c!-- /.setting-menu-row --\x3e\n            <div class="setting-menu-row">\n              <div class="setting-menu-name">\n                <label class="setting-menu-label">强制SSL下载</label>\n              </div>\n              <div class="setting-menu-value">\n                <input type="checkbox" class="setting-menu-checkbox ssl-s">\n              </div>\n            </div>\x3c!-- /.setting-menu-row --\x3e\n            <div class="setting-menu-row">\n              <div class="setting-menu-name">\n                <label class="setting-menu-label">递归下载间隔</label>\n              </div>\n              <div class="setting-menu-value">\n                <input class="setting-menu-input small-o interval-s" type="number" spellcheck="false">\n                <label class="setting-menu-label">(单位:毫秒)</label>\n                <a class="setting-menu-button version-s" id="testAria2" href="javascript:void(0);">测试连接，成功显示版本号</a>\n              </div>\n            </div>\x3c!-- /.setting-menu-row --\x3e\n            <div class="setting-menu-row">\n              <div class="setting-menu-name">\n                <label class="setting-menu-label">下载路径</label>\n              </div>\n              <div class="setting-menu-value">\n                <input class="setting-menu-input downloadPath-s" placeholder="只能设置为绝对路径" spellcheck="false">\n              </div>\n            </div>\x3c!-- /.setting-menu-row --\x3e\n            <div class="setting-menu-row">\n              <div class="setting-menu-name">\n                <label class="setting-menu-label">User-Agent</label>\n              </div>\n              <div class="setting-menu-value">\n                <input class="setting-menu-input userAgent-s" spellcheck="false">\n                <label class="setting-menu-label"></label>\n                <input type="checkbox" class="setting-menu-checkbox browser-userAgent-s">\n                <label class="setting-menu-label for-checkbox">使用浏览器 UA</label>\n              </div>\n            </div>\x3c!-- /.setting-menu-row --\x3e\n            <div class="setting-menu-row">\n              <div class="setting-menu-name">\n                <label class="setting-menu-label">Referer</label>\n              </div>\n              <div class="setting-menu-value">\n                <input class="setting-menu-input referer-s" spellcheck="false">\n              </div>\n            </div>\x3c!-- /.setting-menu-row --\x3e\n            <div class="setting-menu-row">\n              <div class="setting-menu-name">\n                <label class="setting-menu-label">Headers</label>\n              </div>\n              <div class="setting-menu-value">\n                <textarea class="setting-menu-input textarea-o headers-s" type="textarea" spellcheck="false"></textarea>\n              </div>\n            </div>\x3c!-- /.setting-menu-row --\x3e\n          </div>\x3c!-- /.setting-menu-body --\x3e\n          <div class="modal-footer">\n            <div class="setting-menu-copyright">\n              <div class="setting-menu-item">\n                <label class="setting-menu-label">&copy; Copyright</label>\n                <a class="setting-menu-link" href="https://github.com/acgotaku/115" target="_blank">雪月秋水</a>\n              </div>\n              <div class="setting-menu-item">\n                <label class="setting-menu-label">Version: '+this.version+'</label>\n                <label class="setting-menu-label">Update date: '+this.updateDate+'</label>\n              </div>\n            </div>\x3c!-- /.setting-menu-copyright --\x3e\n            <div class="setting-menu-operate">\n              <a class="setting-menu-button large-o blue-o" id="apply" href="javascript:void(0);">应用</a>\n              <a class="setting-menu-button large-o" id="reset" href="javascript:void(0);">重置</a>\n            </div>\n          </div>\n        </div>\n      </div>';document.body.insertAdjacentHTML("beforeend",t);var o=document.querySelector("#settingMenu");o.querySelector(".modal-close").addEventListener("click",(function(){o.classList.remove("open-o"),e.resetSetting()})),document.querySelector("#addRPC").addEventListener("click",(function(){var e=document.querySelectorAll(".rpc-s");Array.from(e).pop().insertAdjacentHTML("afterend",'\n        <div class="setting-menu-row rpc-s">\n          <div class="setting-menu-name">\n            <input class="setting-menu-input name-s" spellcheck="false">\n          </div>\n          <div class="setting-menu-value">\n            <input class="setting-menu-input url-s" spellcheck="false">\n          </div>\n        </div>\x3c!-- /.setting-menu-row --\x3e')}));var s=document.querySelector("#apply"),r=document.querySelector("#message");s.addEventListener("click",(function(){e.saveSetting(),r.innerText="设置已保存"})),document.querySelector("#reset").addEventListener("click",(function(){n.trigger("clearConfigData"),r.innerText="设置已重置"}));var a=document.querySelector("#testAria2");a.addEventListener("click",(function(){i.getVersion(n.getConfigData("rpcList")[0].url,a)}));var c=document.querySelector(".userAgent-s"),l=document.querySelector(".browser-userAgent-s");l.addEventListener("change",(function(){c.disabled=l.checked}))},s.prototype.resetSetting=function(){document.querySelector("#message").innerText="",document.querySelector("#testAria2").innerText="测试连接，成功显示版本号"},s.prototype.updateSetting=function(e){var t=e.rpcList,n=e.configSync,o=e.sha1Check,i=e.vip,s=e.ssl,r=e.small,a=e.interval,c=e.downloadPath,l=e.userAgent,u=e.browserUserAgent,d=e.referer,p=e.headers;document.querySelectorAll(".rpc-s").forEach((function(e,t){0!==t&&e.remove()})),t.forEach((function(e,t){var n=document.querySelectorAll(".rpc-s");if(0===t)n[t].querySelector(".name-s").value=e.name,n[t].querySelector(".url-s").value=e.url;else{var o='\n          <div class="setting-menu-row rpc-s">\n            <div class="setting-menu-name">\n              <input class="setting-menu-input name-s" value="'+e.name+'" spellcheck="false">\n            </div>\n            <div class="setting-menu-value">\n              <input class="setting-menu-input url-s" value="'+e.url+'" spellcheck="false">\n            </div>\n          </div>\x3c!-- /.setting-menu-row --\x3e';Array.from(n).pop().insertAdjacentHTML("afterend",o)}})),document.querySelector(".configSync-s").checked=n,document.querySelector(".sha1Check-s").checked=o,document.querySelector(".vip-s").checked=i,document.querySelector(".ssl-s").checked=s,document.querySelector(".small-s").checked=r,document.querySelector(".interval-s").value=a,document.querySelector(".downloadPath-s").value=c,document.querySelector(".userAgent-s").value=l,document.querySelector(".userAgent-s").disabled=u,document.querySelector(".browser-userAgent-s").checked=u,document.querySelector(".referer-s").value=d,document.querySelector(".headers-s").value=p,this.mostRecentConfigData=e},s.prototype.saveSetting=function(){var e=document.querySelectorAll(".rpc-s"),t={rpcList:Array.from(e).map((function(e){var t=e.querySelector(".name-s").value,n=e.querySelector(".url-s").value;return t&&n?{name:t,url:n}:null})).filter((function(e){return e})),configSync:document.querySelector(".configSync-s").checked,sha1Check:document.querySelector(".sha1Check-s").checked,vip:document.querySelector(".vip-s").checked,ssl:document.querySelector(".ssl-s").checked,small:document.querySelector(".small-s").checked,interval:document.querySelector(".interval-s").value,downloadPath:document.querySelector(".downloadPath-s").value,userAgent:document.querySelector(".userAgent-s").value,browserUserAgent:document.querySelector(".browser-userAgent-s").checked,referer:document.querySelector(".referer-s").value,headers:document.querySelector(".headers-s").value};n.trigger("setConfigData",t)};var r=new s,a=function(e){this.listParameter=e,this.fileDownloadInfo=[],this.currentTaskId=0,this.completedCount=0,this.folders=[],this.files={}};a.prototype.start=function(e,t){void 0===e&&(e=300),this.interval=e,this.done=t,this.currentTaskId=(new Date).getTime(),this.getNextFile(this.currentTaskId)},a.prototype.reset=function(){this.fileDownloadInfo=[],this.currentTaskId=0,this.folders=[],this.files={},this.completedCount=0},a.prototype.addFolder=function(e){this.folders.push(e)},a.prototype.addFile=function(e){this.files[e.pick_code]=e},a.prototype.getNextFile=function(e){var t=this;if(e===this.currentTaskId)if(0!==this.folders.length){this.completedCount++,i.showToast("正在获取文件列表... "+this.completedCount+"/"+(this.completedCount+this.folders.length-1),"inf");var n=this.folders.pop();this.listParameter.search.cid=n.cate_id,i.sendToBackground("fetch",{url:""+this.listParameter.url+i.objectToQueryString(this.listParameter.search),options:this.listParameter.options},(function(o){setTimeout((function(){return t.getNextFile(e)}),t.interval);var i=n.path+o.path[o.path.length-1].name+"/";o.data.forEach((function(e){e.sha?t.files[e.pc]={path:i,isdir:!1,sha1:e.sha,pick_code:e.pc}:t.folders.push({cate_id:e.cid,path:i})}))}))}else 0!==this.files.length?(i.showToast("正在获取下载地址...","inf"),this.getFiles(this.files).then((function(){t.done(t.fileDownloadInfo)}))):(i.showToast("一个文件都没有哦...","war"),this.reset())},a.prototype.getFiles=function(e){throw new Error("subclass should implement this method!")};var c,l="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},u={exports:{}};c=u,function(e){function t(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function n(e,n,o,i,s,r){return t((a=t(t(n,e),t(i,r)))<<(c=s)|a>>>32-c,o);var a,c}function o(e,t,o,i,s,r,a){return n(t&o|~t&i,e,t,s,r,a)}function i(e,t,o,i,s,r,a){return n(t&i|o&~i,e,t,s,r,a)}function s(e,t,o,i,s,r,a){return n(t^o^i,e,t,s,r,a)}function r(e,t,o,i,s,r,a){return n(o^(t|~i),e,t,s,r,a)}function a(e,n){var a,c,l,u,d;e[n>>5]|=128<<n%32,e[14+(n+64>>>9<<4)]=n;var p=1732584193,h=-271733879,m=-1732584194,f=271733878;for(a=0;a<e.length;a+=16)c=p,l=h,u=m,d=f,p=o(p,h,m,f,e[a],7,-680876936),f=o(f,p,h,m,e[a+1],12,-389564586),m=o(m,f,p,h,e[a+2],17,606105819),h=o(h,m,f,p,e[a+3],22,-1044525330),p=o(p,h,m,f,e[a+4],7,-176418897),f=o(f,p,h,m,e[a+5],12,1200080426),m=o(m,f,p,h,e[a+6],17,-1473231341),h=o(h,m,f,p,e[a+7],22,-45705983),p=o(p,h,m,f,e[a+8],7,1770035416),f=o(f,p,h,m,e[a+9],12,-1958414417),m=o(m,f,p,h,e[a+10],17,-42063),h=o(h,m,f,p,e[a+11],22,-1990404162),p=o(p,h,m,f,e[a+12],7,1804603682),f=o(f,p,h,m,e[a+13],12,-40341101),m=o(m,f,p,h,e[a+14],17,-1502002290),p=i(p,h=o(h,m,f,p,e[a+15],22,1236535329),m,f,e[a+1],5,-165796510),f=i(f,p,h,m,e[a+6],9,-1069501632),m=i(m,f,p,h,e[a+11],14,643717713),h=i(h,m,f,p,e[a],20,-373897302),p=i(p,h,m,f,e[a+5],5,-701558691),f=i(f,p,h,m,e[a+10],9,38016083),m=i(m,f,p,h,e[a+15],14,-660478335),h=i(h,m,f,p,e[a+4],20,-405537848),p=i(p,h,m,f,e[a+9],5,568446438),f=i(f,p,h,m,e[a+14],9,-1019803690),m=i(m,f,p,h,e[a+3],14,-187363961),h=i(h,m,f,p,e[a+8],20,1163531501),p=i(p,h,m,f,e[a+13],5,-1444681467),f=i(f,p,h,m,e[a+2],9,-51403784),m=i(m,f,p,h,e[a+7],14,1735328473),p=s(p,h=i(h,m,f,p,e[a+12],20,-1926607734),m,f,e[a+5],4,-378558),f=s(f,p,h,m,e[a+8],11,-2022574463),m=s(m,f,p,h,e[a+11],16,1839030562),h=s(h,m,f,p,e[a+14],23,-35309556),p=s(p,h,m,f,e[a+1],4,-1530992060),f=s(f,p,h,m,e[a+4],11,1272893353),m=s(m,f,p,h,e[a+7],16,-155497632),h=s(h,m,f,p,e[a+10],23,-1094730640),p=s(p,h,m,f,e[a+13],4,681279174),f=s(f,p,h,m,e[a],11,-358537222),m=s(m,f,p,h,e[a+3],16,-722521979),h=s(h,m,f,p,e[a+6],23,76029189),p=s(p,h,m,f,e[a+9],4,-640364487),f=s(f,p,h,m,e[a+12],11,-421815835),m=s(m,f,p,h,e[a+15],16,530742520),p=r(p,h=s(h,m,f,p,e[a+2],23,-995338651),m,f,e[a],6,-198630844),f=r(f,p,h,m,e[a+7],10,1126891415),m=r(m,f,p,h,e[a+14],15,-1416354905),h=r(h,m,f,p,e[a+5],21,-57434055),p=r(p,h,m,f,e[a+12],6,1700485571),f=r(f,p,h,m,e[a+3],10,-1894986606),m=r(m,f,p,h,e[a+10],15,-1051523),h=r(h,m,f,p,e[a+1],21,-2054922799),p=r(p,h,m,f,e[a+8],6,1873313359),f=r(f,p,h,m,e[a+15],10,-30611744),m=r(m,f,p,h,e[a+6],15,-1560198380),h=r(h,m,f,p,e[a+13],21,1309151649),p=r(p,h,m,f,e[a+4],6,-145523070),f=r(f,p,h,m,e[a+11],10,-1120210379),m=r(m,f,p,h,e[a+2],15,718787259),h=r(h,m,f,p,e[a+9],21,-343485551),p=t(p,c),h=t(h,l),m=t(m,u),f=t(f,d);return[p,h,m,f]}function l(e){var t,n="",o=32*e.length;for(t=0;t<o;t+=8)n+=String.fromCharCode(e[t>>5]>>>t%32&255);return n}function u(e){var t,n=[];for(n[(e.length>>2)-1]=void 0,t=0;t<n.length;t+=1)n[t]=0;var o=8*e.length;for(t=0;t<o;t+=8)n[t>>5]|=(255&e.charCodeAt(t/8))<<t%32;return n}function d(e){var t,n,o="0123456789abcdef",i="";for(n=0;n<e.length;n+=1)t=e.charCodeAt(n),i+=o.charAt(t>>>4&15)+o.charAt(15&t);return i}function p(e){return unescape(encodeURIComponent(e))}function h(e){return function(e){return l(a(u(e),8*e.length))}(p(e))}function m(e,t){return function(e,t){var n,o,i=u(e),s=[],r=[];for(s[15]=r[15]=void 0,i.length>16&&(i=a(i,8*e.length)),n=0;n<16;n+=1)s[n]=909522486^i[n],r[n]=1549556828^i[n];return o=a(s.concat(u(t)),512+8*t.length),l(a(r.concat(o),640))}(p(e),p(t))}function f(e,t,n){return t?n?m(t,e):d(m(t,e)):n?h(e):d(h(e))}c.exports?c.exports=f:e.md5=f}(l);var d=u.exports,p=function(){this.publicKey=new window.JSEncrypt,this.publicKey.setPublicKey("-----BEGIN RSA PUBLIC KEY-----\n    MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDR3rWmeYnRClwLBB0Rq0dlm8Mr\n    PmWpL5I23SzCFAoNpJX6Dn74dfb6y02YH15eO6XmeBHdc7ekEFJUIi+swganTokR\n    IVRRr/z16/3oh7ya22dcAqg191y+d6YDr4IGg/Q5587UKJMj35yQVXaeFXmLlFPo\n    kFiz4uPxhrB7BGqZbQIDAQAB\n    -----END RSA PUBLIC KEY-----"),this.privateKey=new window.JSEncrypt,this.privateKey.setPrivateKey("-----BEGIN RSA PRIVATE KEY-----\n    MIICXAIBAAKBgQCMgUJLwWb0kYdW6feyLvqgNHmwgeYYlocst8UckQ1+waTOKHFC\n    TVyRSb1eCKJZWaGa08mB5lEu/asruNo/HjFcKUvRF6n7nYzo5jO0li4IfGKdxso6\n    FJIUtAke8rA2PLOubH7nAjd/BV7TzZP2w0IlanZVS76n8gNDe75l8tonQQIDAQAB\n    AoGANwTasA2Awl5GT/t4WhbZX2iNClgjgRdYwWMI1aHbVfqADZZ6m0rt55qng63/\n    3NsjVByAuNQ2kB8XKxzMoZCyJNvnd78YuW3Zowqs6HgDUHk6T5CmRad0fvaVYi6t\n    viOkxtiPIuh4QrQ7NUhsLRtbH6d9s1KLCRDKhO23pGr9vtECQQDpjKYssF+kq9iy\n    A9WvXRjbY9+ca27YfarD9WVzWS2rFg8MsCbvCo9ebXcmju44QhCghQFIVXuebQ7Q\n    pydvqF0lAkEAmgLnib1XonYOxjVJM2jqy5zEGe6vzg8aSwKCYec14iiJKmEYcP4z\n    DSRms43hnQsp8M2ynjnsYCjyiegg+AZ87QJANuwwmAnSNDOFfjeQpPDLy6wtBeft\n    5VOIORUYiovKRZWmbGFwhn6BQL+VaafrNaezqUweBRi1PYiAF2l3yLZbUQJAf/nN\n    4Hz/pzYmzLlWnGugP5WCtnHKkJWoKZBqO2RfOBCq+hY4sxvn3BHVbXqGcXLnZPvo\n    YuaK7tTXxZSoYLEzeQJBAL8Mt3AkF1Gci5HOug6jT4s4Z+qDDrUXo9BlTwSWP90v\n    wlHF+mkTJpKd5Wacef0vV+xumqNorvLpIXWKwxNaoHM=\n    -----END RSA PRIVATE KEY-----"),this.kts=[240,229,105,174,191,220,191,90,26,69,232,190,125,166,115,136,222,143,231,196,69,218,134,148,155,105,146,11,106,184,241,122,56,6,60,149,38,109,44,86,0,112,86,156,54,56,98,118,47,155,95,15,242,254,253,45,112,156,134,68,143,61,20,39,113,147,138,228,14,193,72,174,220,52,127,207,254,178,127,246,85,154,70,200,235,55,119,164,224,107,114,147,126,81,203,241,55,239,173,42,222,238,249,201,57,107,50,161,186,53,177,184,190,218,120,115,248,32,213,39,4,90,111,253,94,114,57,207,59,156,43,87,92,249,124,75,123,210,18,102,204,119,9,166],this.keyS=[41,35,33,94],this.keyL=[66,218,19,186,120,118,141,55,232,238,4,145]};p.prototype.xor115Enc=function(e,t,n,o){var i,s,r,a,c,l,u,d;if(d=[],0!==(a=t%4))for(i=s=0,c=a;c>=0?s<c:s>c;i=c>=0?++s:--s)d.push(e[i]^n[i%o]);for(i=r=l=a,u=t;l<=u?r<u:r>u;i=l<=u?++r:--r)d.push(e[i]^n[(i-a)%o]);return d},p.prototype.getkey=function(e,t){var n,o=this;return null!=t?function(){var i,s,r;for(r=[],n=i=0,s=e;s>=0?i<s:i>s;n=s>=0?++i:--i)r.push(t[n]+o.kts[e*n]&255^o.kts[e*(e-1-n)]);return r}():12===e?this.keyL.slice(0):this.keyS.slice(0)},p.prototype.asymEncode=function(e,t){var n,o,i,s,r;for(i=117,r="",n=o=0,s=Math.floor((t+i-1)/i);s>=0?o<s:o>s;n=s>=0?++o:--o)r+=window.atob(this.publicKey.encrypt(this.bytesToString(e.slice(n*i,Math.min((n+1)*i,t)))));return window.btoa(r)},p.prototype.asymDecode=function(e,t){var n,o,i,s,r;for(i=128,r="",n=o=0,s=Math.floor((t+i-1)/i);s>=0?o<s:o>s;n=s>=0?++o:--o)r+=this.privateKey.decrypt(window.btoa(this.bytesToString(e.slice(n*i,Math.min((n+1)*i,t)))));return this.stringToBytes(r)},p.prototype.symEncode=function(e,t,n,o){var i,s,r;return i=this.getkey(4,n),s=this.getkey(12,o),(r=this.xor115Enc(e,t,i,4)).reverse(),r=this.xor115Enc(r,t,s,12)},p.prototype.symDecode=function(e,t,n,o){var i,s,r;return i=this.getkey(4,n),s=this.getkey(12,o),(r=this.xor115Enc(e,t,s,12)).reverse(),r=this.xor115Enc(r,t,i,4)},p.prototype.bytesToString=function(e){var t,n,o,i;for(i="",n=0,o=e.length;n<o;n++)t=e[n],i+=String.fromCharCode(t);return i},p.prototype.stringToBytes=function(e){var t,n,o,i;for(i=[],t=n=0,o=e.length;o>=0?n<o:n>o;t=o>=0?++n:--n)i.push(e.charCodeAt(t));return i},p.prototype.encode=function(e,t){var n=this.stringToBytes(d("!@###@#"+t+"DFDR@#@#")),o=this.stringToBytes(e);return o=this.symEncode(o,o.length,n,null),o=n.slice(0,16).concat(o),{data:this.asymEncode(o,o.length),key:n}},p.prototype.decode=function(e,t){var n=this.stringToBytes(window.atob(e));return n=this.asymDecode(n,n.length),this.bytesToString(this.symDecode(n.slice(16),n.length-16,t,n.slice(0,16)))};var h=new p,m=function(e){function t(){var t={search:{aid:1,limit:1e3,show_dir:1,cid:""},url:location.protocol+"//webapi.115.com/files?",options:{credentials:"include",method:"GET"}};e.call(this,t),this.mode="RPC",this.rpcURL="http://localhost:6800/jsonrpc",this.iframe=document.querySelector('iframe[rel="wangpan"]')}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.initialize=function(){var e=this;return this.context=document.querySelector('iframe[rel="wangpan"]').contentDocument,r.init(),r.addMenu(this.context.querySelector("#js_top_panel_box"),"afterbegin"),this.context.querySelector(".right-tvf").style.display="block",this.addMenuButtonEventListener(),r.addContextMenuRPCSectionWithCallback((function(){e.addContextMenuEventListener()})),i.showToast("初始化成功!","inf"),this},t.prototype.startListen=function(){var e=this;window.addEventListener("message",(function(t){var n=t.data.type;if(n&&("selected"===n||"hovered"===n)){e.reset();var o=t.data.data;if(0===o.length)return void i.showToast("请选择一下你要保存的文件哦","war");o.forEach((function(t){t.isdir?e.addFolder(t):e.addFile(t)})),e.start(i.getConfigData("interval"),(function(t){if("RPC"===e.mode&&i.aria2RPCMode(e.rpcURL,t),"TXT"===e.mode&&(i.aria2TXTMode(t),document.querySelector("#textMenu").classList.add("open-o")),"OPEN"===e.mode)for(var n of t)window.open("https://115.com/?ct=play&ac=location&pickcode="+n.pickcode)}))}})),this.iframe.addEventListener("load",(function(){e.initialize(),window.postMessage({type:"refresh"},location.origin)}))},t.prototype.addMenuButtonEventListener=function(){var e=this;this.context.querySelector("#aria2List").addEventListener("click",(function(t){var n=t.target.dataset.url;n&&(e.rpcURL=n,e.getSelected(),e.mode="RPC"),"aria2Text"===t.target.id&&(e.getSelected(),e.mode="TXT"),"batchOpen"===t.target.id&&(e.getSelected(),e.mode="OPEN")}))},t.prototype.addContextMenuEventListener=function(){var e=this;this.context.querySelector("#more-menu-rpc-section").addEventListener("click",(function(t){var n=t.target.dataset.url;n&&(e.rpcURL=n,e.getHovered(),e.mode="RPC")}))},t.prototype.getSelected=function(){window.postMessage({type:"getSelected"},location.origin)},t.prototype.getHovered=function(){window.postMessage({type:"getHovered"},location.origin)},t.prototype.getFile=function(e){return i.getConfigData("vip")?this.getFileFromProAPI(e):this.getFileFromWebAPI(e)},t.prototype.getFileFromWebAPI=function(e){var t={credentials:"include",method:"GET"};return new Promise((function(n){i.sendToBackground("fetch",{url:location.protocol+"//webapi.115.com/files/download?pickcode="+e,options:t},(function(e){var t=e.file_url.match(/.*115.com(\/.*\/)/)[1];i.requestCookies([{path:t}]).then((function(t){e.cookies=t,n(e)}))}))}))},t.prototype.getFileFromProAPI=function(e){var t=Date.now(),n=Math.floor(t/1e3),o=h.encode(JSON.stringify({pickcode:e}),n),s=o.data,r=o.key,a={headers:{"Content-Type":"application/x-www-form-urlencoded"},credentials:"include",method:"POST",body:"data="+encodeURIComponent(s)};return new Promise((function(t){i.sendToBackground("fetch",{url:"https://proapi.115.com/app/chrome/downurl?t="+n,options:a},(function(n){if(n.state){var o=JSON.parse(h.decode(n.data,r)),s=Object.values(o).pop();s.pickcode=s.pick_code,s.file_url=s.url.url;var a=s.file_url.match(/.*115.com(\/.*\/)/)[1];i.requestCookies([{path:a}]).then((function(e){s.cookies=e,t(s)}))}else t(e)}))}))},t.prototype.getFiles=function(e){var t=this,n=Object.keys(e).map((function(e){return t.getFile(e)}));return new Promise((function(o){Promise.all(n).then((function(n){n.forEach((function(n){t.isObject(n)?t.fileDownloadInfo.push({name:e[n.pickcode].path+n.file_name,link:n.file_url,size:n.file_size,sha1:e[n.pickcode].sha1,cookies:n.cookies,pickcode:n.pickcode}):console.log(e[n])})),o()}))}))},t.prototype.isObject=function(e){return null!==e&&"object"==typeof e},t}(a);(new m).initialize().startListen()}();